GlobalPropProcedureNameExtensionApp )
    #Set(%StrPosResult8473,StrPos(%Procedure,%RegEx8473,%TB2GlobalPropNoCaseSensitivity ))

    #IF(%StrPosResult8473 = 1)
        #Reject
    #End

    #Set(%RegEx8473,'^' & %TB2GlobalPropTemplatePrefix & %TB2GlobalPropProcedureNameExtensionProc )
    #Set(%StrPosResult8473,StrPos(%Procedure,%RegEx8473,%TB2GlobalPropNoCaseSensitivity ))

    #IF(%StrPosResult8473 = 1)
        #Reject
    #End


    #Set(%RegEx8473,'^' & %TB2GlobalPropTemplatePrefix & %TB2GlobalPropProcedureNameExtension )
    #Set(%StrPosResult8473,StrPos(%Procedure,%RegEx8473,%TB2GlobalPropNoCaseSensitivity ))

    #IF(%StrPosResult8473 = 1)
        #Accept
    #Else
        #Reject
    #End

#EndIF
#EndRestrict
#Prepare
#Set(%TB2TemplateExtensionProcedure,%Procedure)
#IF(NOT %TB2EmbedPromptTree)
#Call(%TB2grpEmbedTreeNodesAdd)
#EndIF
#EndPrepare
#Display('#Extension template'),At(0,,200),Prop(Prop:FontColor,0FFFFFFH),Prop(Prop:Background,00000FFH),Prop(Prop:CenterOffSet,0)
#Sheet,HScroll
#Tab('0&1 #Extension')
    #Display('')
    #Prompt('Name',@s255),%TB2TemplateExtensionName,Req,At(60,,120,10),Default(%TB2grpTemplateExtensionDefaultName(%Procedure))
        #Validate(%TB2valStringEncapsulationRemove(%TB2TemplateExtensionName),'#Validate(%TB2valStringEncapsulationRemove(%TB2TemplateExtensionName))')
        #Validate(%TB2valValidateReservedWord(%TB2TemplateExtensionName),'Reserved Words not allowed')
        #Validate(%TB2valValidateClarionLabel(%TB2TemplateExtensionName),'Invalid Clarion Label')
        #Validate(%TB2valValidateNamingSchemaExtension(%TB2TemplateExtensionName),'Invalid Naming Scheme')
    #Prompt('''Description''',@s255),%TB2TemplateExtensionDescription,Req,At(60,,120,10),Default(%TB2grpTemplateExtensionDefaultDescription())
        #Validate(%TB2valStringEncapsulationRemove(%TB2TemplateExtensionDescription),'#Validate(%TB2valStringEncapsulationRemove(%TB2TemplateExtensionDescription))')
        #Validate(%TB2valValidateStringConstant(%TB2TemplateExtensionDescription),'#Validate(%TB2valValidateStringConstant(%TB2TemplateExtensionDescription))')
        #Validate(%TB2valStringEncapsulationAdd(%TB2TemplateExtensionDescription),'#Validate(%TB2valStringEncapsulationAdd(%TB2TemplateExtensionDescription))')
    #Prompt('''Target''',@s255),%TB2TemplateExtensionTarget,At(60,,120,10),Default(%TB2grpTemplateExtensionDefaultTarget())
        #Validate(%TB2valStringEncapsulationRemove(%TB2TemplateExtensionTarget),'#Validate(%TB2valStringEncapsulationRemove(%TB2TemplateExtensionTarget))')
        #Validate(%TB2valValidateStringConstant(%TB2TemplateExtensionTarget),'#Validate(%TB2valValidateStringConstant(%TB2TemplateExtensionTarget))')
        #Validate(%TB2valStringEncapsulationAdd(%TB2TemplateExtensionTarget),'#Validate(%TB2valStringEncapsulationAdd(%TB2TemplateExtensionTarget))')
    #Prompt('''~helpid''',@s255),%TB2TemplateExtensionHelpID,At(60,,120,10)
        #Validate(%TB2valStringEncapsulationRemove(%TB2TemplateExtensionHelpID),'#Validate(%TB2valStringEncapsulationRemove(%TB2TemplateExtensionHelpID))')
        #Validate(%TB2valValidateHelpID(%TB2TemplateExtensionHelpID),'#Validate(%TB2valValidateHelpID(%TB2TemplateExtensionHelpID))')
        #Validate(%TB2valStringEncapsulationAdd(%TB2TemplateExtensionHelpID),'#Validate(%TB2valStringEncapsulationAdd(%TB2TemplateExtensionHelpID))')
    #Prompt('Multi',Check),%TB2TemplateExtensionMulti,At(60)
    #Prompt('Expression',@s255),%TB2TemplateExtensionExpression,At(60,,120,10)
    #Prompt('Show',Check),%TB2TemplateExtensionShow,At(60)
    #Prompt('''Message''',@s255),%TB2TemplateExtensionPrimaryMessage,At(60,,120,10)
        #Validate(%TB2valStringEncapsulationRemove(%TB2TemplateExtensionPrimaryMessage),'#Validate(%TB2valStringEncapsulationRemove(%TB2TemplateExtensionPrimaryMessage))')
        #Validate(%TB2valValidateStringConstant(%TB2TemplateExtensionPrimaryMessage),'#Validate(%TB2valValidateStringConstant(%TB2TemplateExtensionPrimaryMessage))')
        #Validate(%TB2valStringEncapsulationAdd(%TB2TemplateExtensionPrimaryMessage),'#Validate(%TB2valStringEncapsulationAdd(%TB2TemplateExtensionPrimaryMessage))')
#Enable(%TB2TemplateExtensionPrimaryMessage)
    #Prompt('Flag',Drop('<Blank>|Optional|OptKey|NoKey')),%TB2TemplateExtensionPrimaryFlag,Default('<Blank>'),At(60,,120,10)
#EndEnable
#Boxed('')
    #Display('Parent Templates are #Code, #Control or #Extension.')
    #Prompt('Require a parent template',Check),%TB2TemplateExtensionReqParent,At(60)
#Enable(%TB2TemplateExtensionReqParent)
    #Button('Default #Code Template name'),At(10,,175,12),WhenAccepted(%TB2grpTemplateExtensionSetClipboardDefaultCodeTemplate())
    #EndButton
    #Button('Default #Control Template name'),At(10,,175,12),WhenAccepted(%TB2grpTemplateExtensionSetClipboardDefaultControlTemplate())
    #EndButton
    #Button('Default #Extension Template name'),At(10,,175,12),WhenAccepted(%TB2grpTemplateExtensionSetClipboardDefaultExtensionTemplate())
    #EndButton
    #Prompt('REQ Addition',Procedure),%TB2TemplateExtensionReqAddition,At(60,,120,10),Prop(Prop:DropWidth,240)
        #Validate(%TB2valValidateReqAddition(%TB2TemplateExtensionProcedure,%TB2TemplateExtensionReqAddition),'#Validate(%TB2valValidateExtensionReqExtension(%TB2TemplateExtensionName,%TB2TemplateExtensionReqAddition))')
        #Validate(%TB2valValidateNamingSchemaReqAddition(%TB2TemplateExtensionReqAddition),'Invalid Naming Scheme')
#Enable(%TB2TemplateExtensionReqAddition)
    #Prompt('REQ Priority',Drop('<Blank>|Before|After')),%TB2TemplateExtensionReqAdditionPriorityPlace,At(60,,120,10)
#EndEnable
#EndEnable
#EndBoxed
#Boxed('')
    #Prompt('Place Type',Option),%TB2TemplateExtensionPlaceType,Default('Priority Place')
    #Prompt('Legacy Place',Radio)
    #Prompt('Priority Place',Radio)
#Enable(%TB2TemplateExtensionPlaceType='Legacy Place')
    #Prompt('Legacy Place',Drop('<Blank>|First|Last')),%TB2TemplateExtensionPlacePriority,Default('<Blank>'),At(60,,120,10)
#EndEnable
#Enable(%TB2TemplateExtensionPlaceType='Priority Place')
    #Prompt('Enable Priority',Check),%TB2TemplateExtensionPriorityEnable,At(60)
#Enable(%TB2TemplateExtensionPriorityEnable)
    #Prompt('Priority Place',Spin(@n6,1,10000,1)),%TB2TemplateExtensionPriorityNumber,Req,Default(5000),At(60,,120,10)
#EndEnable
#EndEnable
#EndBoxed
#EndTab
#Tab('0&2 Optional #Sections')
    #Display('')
    #Prompt('#Restrict',Check),%TB2TemplateExtensionOptionalSectionRestrict,At(10)
    #Display('Unhides the #Restrict embed and tab.')
    #Display('')
    #Prompt('#Prepare',Check),%TB2TemplateExtensionOptionalSectionPrepare,At(10)
    #Display('Unhides the #Prepare embed and #Equate(s) tab.')
    #Display('#Prepare code is used to prepare #Prompts.')
    #Display('')
    #Prompt('#Include(''File.tpw'')',Check),%TB2TemplateExtensionOptionalSectionInclude,At(10)
    #Display('#Include files required for the #Application template.')
    #Display('')
#EndTab
#Tab('0&3 #Restrict'),Where(%TB2TemplateExtensionOptionalSectionRestrict = %True)
    #Display('')
    #Display('Expression:')
    #Prompt('Expression',Text),%TB2TemplateExtensionRestrictWhere
    #Display('The expression used in the #Restrict,Where() clause.')
    #Display('If the expression evaluates to %True, the template')
    #Display('code defined in the #Restrict embed is processed.')
    #Display('#Accept continues processing the rest of this template.')
    #Display('#Reject terminates processing the rest of this template.')
    #Display('')
#EndTab
#Tab('0&4 #Equate(s)'),Where(%TB2TemplateExtensionOptionalSectionPrepare = %True)
    #Display('')
    #Display('#Equates are generated/defined first inside the')
    #Display('#Prepare and #System sections by this template, but')
    #Display('can be defined and used anywhere in template code.')
    #Display('')
    #Button('#Equates'),Multi(%TB2TemplateExtensionEquatesList,%TB2TemplateExtensionEquatesDescription),Inline
        #Sheet
            #Tab('0&1 #Equate')
                #Display('')
                #Display('[TemplatePrefix][TemplateSymbolPrefix][Description]')                                                                                             ,Prop(Prop:Font,'Lucida Console'),Prop(Prop:FontStyle,400),Prop(Prop:FontSize,7)
                #Display('[' & %TB2GlobalPropTemplatePrefix & '][' & %TB2GlobalPropSymbolPrefixEquate &'][Description]')          ,Prop(Prop:Font,'Lucida Console'),Prop(Prop:FontStyle,400),Prop(Prop:FontSize,7)
                #Enable(%TB2GlobalPropNamingSchemaHandling<>'Enforce')
                    #Prompt('%Symbol',@s255),%TB2TemplateExtensionEquatesSymbol,At(65,,120,10),req
                        #Validate(%TB2valStringEncapsulationRemove(%TB2TemplateExtensionEquatesSymbol),'#Validate(%TB2valStringEncapsulationRemove(%TB2TemplateExtensionEquatesSymbol))')
                        #Validate(%TB2valValidateReservedWord(%TB2TemplateExtensionEquatesSymbol),'Reserved Words not allowed')
                        #Validate(%TB2valValidateClarionLabel(%TB2TemplateExtensionEquatesSymbol),'Invalid Clarion Label')
                        #Validate(%TB2valValidateNamingSchemaSymbolEquate(%TB2TemplateExtensionEquatesSymbol),'Invalid Naming Scheme')
                        #Validate(%TB2valValidateSymbol(%TB2TemplateExtensionEquatesSymbol),'#Validate(%TB2valValidateSymbol(%TB2TemplateExtensionEquatesSymbol))')
                #EndEnable
                #Enable(%TB2GlobalPropNamingSchemaHandling='Enforce')
                    #Prompt('%Symbol Field',Field),%TB2TemplateExtensionEquatesSymbolField,At(65,,120,10),req
                        #Validate(%TB2valStringEncapsulationRemove(%TB2TemplateExtensionEquatesSymbolField),'#Validate(%TB2valStringEncapsulationRemove(%TB2TemplateUtilityEquatesSymbolField))')
                        #Validate(%TB2valValidateReservedWord(%TB2TemplateExtensionEquatesSymbolField),'Reserved Words not allowed')
                        #Validate(%TB2valValidateClarionLabel(%TB2TemplateExtensionEquatesSymbolField),'Invalid Clarion Label')
                        #Validate(%TB2valValidateNamingSchemaSymbolEquate(%TB2TemplateExtensionEquatesSymbolField),'Invalid Naming Scheme')
                        #Validate(%TB2valValidateCopyFromTo(%TB2TemplateExtensionEquatesSymbolField,%TB2TemplateExtensionEquatesSymbol),'#Validate(%TB2valValidateCopyFromTo(%TB2TemplateExtensionEquatesSymbolField,%TB2TemplateExtensionEquatesSymbol))')
                        #Validate(%TB2valValidateSymbol(%TB2TemplateExtensionEquatesSymbol),'#Validate(%TB2valValidateSymbol(%TB2TemplateExtensionEquatesSymbol))')
                #EndEnable
                #Display('Value or Expression')
                #Prompt('Value/Expression',Text),%TB2TemplateExtensionEquatesValueExpression
                #Display('Encapsulate strings with single quotes.')
                #Display('Call template #Groups using:')
                #Display('%Groupname(%pParam1,%pParam2) or')
                #Display('%Groupname() and Clarion language')
                #Display('functions can also be used here.')
            #EndTab
            #Tab('0&2 Debug')
                #Display('%TB2TemplateExtensionEquatesDescription')
                #Prompt('',Text),%TB2TemplateExtensionEquatesDescription
                #Validate(%TB2valGenerateEquatesDescription(%TB2TemplateExtensionEquatesSymbol,%TB2TemplateExtensionEquatesValueExpression,%TB2TemplateExtensionEquatesDescription),'#Validate(%TB2valGenerateEquatesDescription())')
            #EndTab
        #EndSheet
    #EndButton
#EndTab
#Tab('0&5 #Include(''File.tpw'')'),Where(%TB2TemplateExtensionOptionalSectionInclude = %True)
    #Display('')
    #Display('An embed is also available for use for non-procedures.')
    #Display('Select the procedure to include for use in this')
    #Display('#Extension template.')
    #Display('')
    #Prompt('Procedures',From(%Procedure)),%TB2TemplateExtensionIncludeFileSelectionExtensionsTab,Selection('Procedures'),Inline
    #Display('')
#EndTab
#Tab('0&6 #Prompt Tree Nodes')
    #Display('Use with Extreme Caution!'),At(2,,190,14),Prop(Prop:FontColor,0FFFFFFH),Prop(Prop:Background,00000FFH),Prop(Prop:CenterOffSet,0)
    #Button('#Embeds'),Multi(%TB2EmbedPromptTree,%TB2EmbedPromptNodeNumber &' '& %TB2EmbedPromptNodeName ),Inline,At(,,,100)
        #Sheet
            #Tab('0&1 #Embed')
                #Display('')
                #Prompt('Node Name',@s255),%TB2EmbedPromptNodeName,Req,Default( Format(Items(%TB2EmbedPromptTree)+1,@n02) )
                #Display('')
                #Display('')
            #EndTab
            #Tab('0&2 Debug')
                #Display('')
                #Prompt('Number',@s255),%TB2EmbedPromptNodeNumber
                #Display('')
                #Display('%TB2EmbedPromptTreeNode')
                #Prompt('',Text),%TB2EmbedPromptTreeNode,Default('05 #Prompt Code Tree|' & %TB2EmbedPromptNodeNumber &' '& %TB2EmbedPromptNodeName )
                    #Validate(%TB2valEmbedPromptTreeNode(%TB2EmbedPromptTreeNode),'#Validate(%TB2valEmbedPromptTreeNode(%TB2EmbedPromptTreeNode))')
                #Display('')
                #Display('')
            #EndTab
        #EndSheet
    #EndButton
    #Display('Do Not Use The Hidden Listbox Buttons'),At(2,135,190,14),Prop(Prop:FontColor,0FFFFFFH),Prop(Prop:Background,00000FFH),Prop(Prop:CenterOffSet,0)
    #Display('If you accidentally delete a record, click Remove All')
    #Display('and then click Add x Nodes where X is the number of')
    #Display('nodes that existed before deleting a record.')
    #Display('')
    #Display('To change or remove the text on a node use the'),At(2,,190),Prop(Prop:FontColor,0FFFFFFH),Prop(Prop:Background,00000FFH),Prop(Prop:CenterOffSet,0)
    #Display('Embed Code Template #Embed Node Name.'),At(2,,190),Prop(Prop:FontColor,0FFFFFFH),Prop(Prop:Background,00000FFH),Prop(Prop:CenterOffSet,0)
    #Display('')
    #Prompt('Number Picture',@s255),%TB2EmbedPromptNumberPicture,Default('@n02')
    #Display('The number picture should be changed to @n03')
    #Display('if adding 100 or more nodes.')
    #Display('')
    #Prompt('Number of Nodes',Spin(@n2,1,99)),%TB2EmbedPromptTreeNumberOfNodes,Default(20)
    #Display('The default number of nodes is 20')
    #Button('Add x Nodes'),At(10,,175,11),WhenAccepted(%TB2grpEmbedTreeNodesAdd())
    #EndButton
    #Button('Remove x Nodes'),At(10,,175,11),WhenAccepted(%TB2grpEmbedTreeNodesRemove())
    #EndButton
    #Display('')
    #Button('Remove All'),At(10,,175,11),WhenAccepted(%TB2grpEmbedTreeNodesRemoveAll())
    #EndButton
#EndTab
#Tab('0&7 Debug')
    #Display('')
    #Display('#Extension output code line')
    #Display('%TB2TemplateExtensionOutputCodeLine')
    #Prompt('%TB2TemplateExtensionOutputCodeLine',Text),%TB2TemplateExtensionOutputCodeLine,At(,,180)
    #Validate(%TB2valTemplateExtensionOutputCodeLine(),'#Validate(%TB2valTemplateExtensionOutputCodeLine()' )
    #Prompt('%TB2TemplateExtensionProcedure',@s255),%TB2TemplateExtensionProcedure
#EndTab
#EndSheet
%TB2TemplateExtensionOutputCodeLine
#IF(%TB2TemplateExtensionOptionalSectionRestrict = %True)
#! #Restrict & #Restrict,Where(Expression) code
#IF(%TB2TemplateExtensionRestrictWhere)
%#Restrict,Where(%TB2TemplateExtensionRestrictWhere)
#Else
%#Restrict
#EndIF
#EMBED(%TB2EmbedRestrict,'02 #Restrict where this template can be used in the Appgen')
%#EndRestrict
#EndIF
#IF(%TB2TemplateExtensionOptionalSectionPrepare)
%#Prepare
#For(%TB2TemplateExtensionEquatesList)
%TB2TemplateExtensionEquatesDescription
#EndFor
#EMBED(%TB2EmbedPrepare,'03 #Prepare fill or process template prompts')
%#EndPrepare
#EndIF
#Embed(%TB2EmbedPrompt,'04 #Prompt Code')
#IF(%TB2EmbedPromptTree)
    #For(%TB2EmbedPromptTree)
#EMBED(%TB2EmbedPromptTree,'05 #Prompt Tree Code'),%TB2EmbedPromptTree,Tree(%TB2EmbedPromptTreeNode)
    #EndFor
#EndIF
#IF(%TB2TemplateExtensionOptionalSectionInclude)
#EMBED(%TB2EmbedInclude,'06 #Include(''Files.tpw'') not handled by this template')
#For(%TB2TemplateExtensionIncludeFileSelectionExtensionsTab)
#Fix(%Procedure,%TB2TemplateExtensionIncludeFileSelectionExtensionsTab)
%#Include('%Procedure.tpw')
#EndFor
#EndIf
#EMBED(%TB2EmbedUnstructured,'07 Unstructured Template Hand Code')
